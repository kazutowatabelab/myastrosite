---
// src/layouts/BlogPostLayout.astro
import BlogPost from './BlogPost.astro';

const { content, lang = 'jp', ...props } = Astro.props;

const isEn = lang === 'en';

// 修正ポイント：英語タイトルがない場合は日本語タイトルを、それもなければ空文字ではなく"Untitled"を返す
const title = isEn 
  ? (content?.title_en || content?.title || props.title || "Untitled") 
  : (content?.title || props.title || "無題");

const pubDate = content?.publishedAt || props.pubDate;
const heroImage = content?.eyecatch?.url || props.heroImage;

const currentSlug = content?.id || '';
const jpPath = `/blog/jp/${currentSlug}`;
const enPath = `/blog/en/${currentSlug}`;
---

<BlogPost title={title} pubDate={pubDate} heroImage={heroImage} {...props}>
  <div class="lang-switch">
    <a href={jpPath} class={lang === 'jp' ? 'active' : ''}>日本語</a>
    <span>/</span>
    <a href={enPath} class={lang === 'en' ? 'active' : ''}>English</a>
  </div>
  
  <slot />
</BlogPost>

<style>
  /* 言語切り替えボタン */
  .lang-switch {
    text-align: right;
    margin-bottom: 2rem;
    font-size: 0.9rem;
  }
  .lang-switch a {
    text-decoration: none;
    color: #888;
  }
  .lang-switch a.active {
    font-weight: bold;
    color: #000;
    text-decoration: underline;
  }

  /* アイキャッチ画像の強制上書き
     !important を付与して元のテンプレートのスタイルに勝ちます
     8分の1のサイズで左寄せ
  */
  :global(.hero-image-container) {
    width: auto !important;
    max-width: none !important;
    display: flex !important;
    justify-content: flex-start !important; /* 左寄せ */
    margin: 0 0 2rem 0 !important;
  }

  :global(.hero-image-container img) {
    width: 150px !important;      /* 元の1200pxの8分の1 */
    max-width: 150px !important;
    height: auto !important;
    margin-left: 0 !important;   /* 強制左寄せ */
    margin-right: auto !important;
    border-radius: 8px;
    object-fit: cover !important;
  }
</style>