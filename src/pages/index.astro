---
import { getBlogs } from '../lib/microcms';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

// データの取得を try-catch で囲み、エラー時に画面が止まらないようにします
let posts = [];
try {
	const allPosts = await getBlogs();
	posts = allPosts.slice(0, 3);
} catch (e) {
	console.error("Failed to fetch posts:", e);
}

const currentLang = 'en';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			/* CSS部分は変更なしのため省略（以前のコードのままでOKです） */
			:root {
				--bg-primary: #0a0a0f;
				--bg-secondary: #121218;
				--bg-card: #1a1a24;
				--text-primary: #e8e8e8;
				--text-secondary: #a0a0a8;
				--accent: #4a9eff;
				--accent-hover: #6bb3ff;
				--border: #2a2a35;
			}
			body { background: var(--bg-primary); color: var(--text-primary); margin: 0; font-family: sans-serif; }
			.hero-section { position: relative; min-height: 30vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2rem; background: linear-gradient(135deg, #0a0a0f 0%, #121218 50%, #0f0f15 100%); text-align: center; overflow: hidden; }
			.hero-title { font-size: 4rem; font-weight: 700; margin: 0 0 1rem 0; background: linear-gradient(135deg, #ffffff 0%, #a0a0a8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; position: relative; z-index: 1; width: 100%; }
			.hero-subtitle { font-size: 1.5rem; color: var(--text-secondary); position: relative; z-index: 1; width: 100%; }
			.content-section { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem; }
			.section-title { font-size: 2.5rem; font-weight: 700; margin: 0 0 3rem 0; color: var(--text-primary); }
			.logs-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; margin-bottom: 6rem; }
			.log-card { background: var(--bg-card); border: 2px solid var(--accent); border-radius: 12px; padding: 2rem; transition: all 0.3s ease; display: flex; flex-direction: column; text-decoration: none; color: inherit; box-shadow: 0 4px 12px rgba(74, 158, 255, 0.15); position: relative; overflow: hidden; }
			.log-card:hover { transform: translateY(-6px); border-color: var(--accent-hover); box-shadow: 0 12px 32px rgba(74, 158, 255, 0.25); }
			.log-card-title { font-size: 1.5rem; font-weight: 700; margin: 0 0 1rem 0; color: var(--text-primary); line-height: 1.3; }
			.time-line-indicator { position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: linear-gradient(180deg, var(--accent) 0%, var(--accent-hover) 50%, var(--accent) 100%); border-radius: 0 4px 4px 0; }
			.time-title { position: relative; padding: 0.75rem 1rem; border-left: 3px solid var(--accent); border-radius: 4px; }
			.log-card-description { font-size: 1rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6; }
			.log-card-date { font-size: 0.875rem; color: var(--accent); margin-top: auto; font-weight: 500; }
			.log-card-image { width: 150px !important; height: 75px !important; max-width: 150px !important; max-height: 75px !important; object-fit: cover; border-radius: 8px; margin-bottom: 1.5rem; float: left; margin-right: 1rem; }
			.log-card-image-placeholder { width: 150px; height: 75px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); border: 2px dashed var(--border); float: left; margin-right: 1rem; }
			@media (max-width: 768px) { .hero-title { font-size: 2.5rem; } .logs-grid { grid-template-columns: 1fr; } }
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section class="hero-section">
				<h1 class="hero-title">Mirai Anchorage Japan</h1>
				<p class="hero-subtitle">Exploring the possibilities of Unity and AI.</p>
			</section>

			<section class="content-section">
				<h2 class="section-title">Latest Logs</h2>
				<div class="logs-grid">
					{posts.length > 0 ? (
						posts.map((post) => (
							<a href={`/blog/en/${post.id}`} class="log-card">
								<div class="time-line-indicator"></div>
								{post.eyecatch?.url ? (
									<img 
										class="log-card-image" 
										src={post.eyecatch.url} 
										alt={post.title_en || post.title || 'post image'}
									/>
								) : (
									<div class="log-card-image-placeholder">
										<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
									</div>
								)}
								{/* フィールドが存在するか慎重にチェックします */}
								<h3 class="log-card-title time-title">
									{post.title_en ? post.title_en : (post.title || 'Untitled')}
								</h3>
								<p class="log-card-description">
									{post.description_en ? post.description_en : (post.description || '')}
								</p>
								<p class="log-card-date">
									{post.publishedAt ? <FormattedDate date={new Date(post.publishedAt)} /> : ''}
								</p>
							</a>
						))
					) : (
						<p>No posts found.</p>
					)}
				</div>
			</section>
		</main>
		<Footer />
	</body>
</html>